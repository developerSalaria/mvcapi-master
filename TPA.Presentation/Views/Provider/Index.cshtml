@{
    ViewBag.Title = "serviceprovider";
}
<style>
    #providerTable_filter {
        float: right !important;
    }

        #providerTable_filter input {
            width: 207px !important;
        }
</style>
<div class="kt-portlet kt-portlet--mobile pea-page" style="box-shadow: 5px 5px 15px 5px rgba(0,0,0,0.35);" id="providerServices">
    <div class="kt-portlet__body">
        <div class="row">
            <div class="col-md-12">
                <a class="btn text-white mb-2" id="btnAddNewProvider" style="background-color:#F35869 ;float:right !important;"><i class="fas fa-plus"></i>Add</a>
                @*<button class="btn btn-success mr-2" style="float:right !important;" id="exportxlsProvider"><i class="fas fa-file-excel"></i>export XLS</button>*@
                <div class="kt-margin-r-10 kt-margin-l-10" style="float:right !important;" id="exportButtonHolder">
                    @*<button class="btn btn-success" id="exportxls"><i class="fas fa-file-excel"></i>export XLS</button>*@
                </div>
            </div>
        </div>
        <div id="kt_table_1_wrapper" class="dataTables_wrapper dt-bootstrap4">
            <div class="row">
                <div class="col-sm-12" id="personsListDiv">
                    <table class="table table-striped table-bordered table-hover table-checkable" id="providerTable">
                        <thead>
                            <tr style="background-color: #22b9ff;">
                                <th style="color:#fff" data-field="Name">Name</th>
                                <th style="color:#fff" data-field="TelephoneNo">Contact</th>
                                <th style="color:#fff" data-field="Email">Email</th>
                                <th style="color:#fff" data-field="Address">Location</th>
                                <th style="color:#fff" data-field="UpdatedOn">Last Modified</th>
                                <th style="color:#fff" data-field="Actions"></th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="editServiceModal" class="modal animated slideInRight in slideInLeft out" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-xl" style="max-width: 85%">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title font-weight-bold">
                    Provider
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body" id="editServiceModalBody">
                
            </div>
            @*<div class="modal-footer">
                <button type="button" class="btn btn-primary btn-bold btn-upper btn-font-sm" data-dismiss="modal">Close</button>
            </div>*@
        </div>
    </div>
</div>

<div id="servicesModal" class="modal animated slideInRight in slideInLeft out" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-xl" style="max-width: 85%">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title font-weight-bold">
                    Services
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body" id="servicesModalBody">
                <div id="kt_table_1_wrapper" class="dataTables_wrapper dt-bootstrap4">
                    <div class="row">
                        <div class="col-sm-12" id="personsListDiv">
                            <table class="table table-striped table-bordered table-hover table-checkable" id="providerServicesTable">
                                <thead>
                                    <tr style="background-color: #22b9ff;">
                                        <th style="color:#fff" data-field="EName">Name</th>
                                        <th style="color:#fff" data-field="AName">Code</th>
                                        <th style="color:#fff" data-field="ServiceAmount">Price</th>
                                        <th style="color:#fff" data-field="UpdatedOn">Last Modified</th>
                                        <th style="color:#fff" data-field="Actions"></th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary btn-bold btn-upper btn-font-sm" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
@section scripts
    {
    @Scripts.Render("~/Scripts/Datatable/Datatable/datatables.min.js")

<script type="text/javascript">
        $(document).ready(function () {

            $("#providerServices").on("click", "#editService", function () {
                $.ajax({
                    url: '@Url.Action("EditProvider", "Provider")',
                    data: {
                        providerId: $(this).data("id")
                    },
                    success: function (data) {
                        $("#editServiceModalBody").html(data);
                        $("#editServiceModal").modal("show");
                    }
                })
            })

            //use for add new Provider
            $("#btnAddNewProvider").on("click", function () {
                $.ajax({
                    url: '@Url.Action("EditProvider", "Provider")',
                    success: function (data) {
                        $("#editServiceModalBody").html(data);
                        $("#editServiceModal").modal("show");
                    }
                })
            });


             //use for save  provider
            $("#btnSaveProvider").on("click", function () {
                $.ajax({
                    type: 'Post',
                    url: '@Url.Action("EditProvider", "Provider")',
                    data: function (d) {
                        id = $("#txtProviderId"),
                            name = $("#txtProviderName").val(),
                            TelephoneNo = $("#txtTelephoneNo").val();
                            Email = $("#txtTelephoneNo").val();
                            CountryID = $("#ddlCountryID").val();
                            StateId = $("#ddlStateID").val();
                            CityId = $("#ddlCityID").val();
                            ContractNumber = $("#txtContractNumber").val();
                            ContractStartDate = $("#txtContractStartDate").val();
                            ContractExpiryDate = $("#txtContractExpiryDate").val();
                            Address = $("#txtAddress").val();
                            IsStatusActive =  $("#checkBoxActiveStatus").val();
                            PaymentDetails = $("#txtPaymentDetails").val();
                        },
                    success: function (data) {
                    }
                })
            });

             $("#providerServices").on("click", "#showServices", function () {
                 var providerServicesTable = $('#providerServicesTable').DataTable({
                        "bPaginate": true,
                        "bInfo": false,
                        "processing": true, // for show progress bar
                        "serverSide": true, // for process server side
                        "filter": true, // this is for disable filter (search box)
                        "orderMulti": false, // for disable multiple column at once
                        "language": {
                            "loadingRecords": "&nbsp;",
                            "sProcessing": "<i class='fas fa-spinner fa-2x text-success fa-spin'></i>",
                            "emptyTable": "No data available in table",
                            "info": "sInfo",
                            "infoFiltered": "sInfoFiltered",
                            "infoPostFix": "",
                            "thousands": ",",
                            "lengthMenu": "Show _MENU_ entries",
                            "loadingRecords": "Loading",
                            "processing": "Processing",
                            "search": "Search:",
                            "zeroRecords": "No records",
                            "aria": {
                                "sortAscending": ": Asc",
                                "sortDescending": ": Desc"
                            }
                        },
                        "bDestroy": true,
                        "ajax": {
                            "url": `@Url.Action("GetProviderServices", "Provider")?providerId=${$(this).data("id")}`,
                            "type": "Get",
                        },
                        "columns": [
                            { "data": "EName", "name": "Name", "width": "20%" },
                            { "data": "AName", "name": "Code", "width": "20%" },
                            { "data": "ServiceAmount", "name": "Price", "width": "20%" },
                            {
                                "data": "UpdatedOn", "name": "Last Modified", "type": "Date", "width": "25%", render: function (data, type, row) {
                                    return moment(row.UpdatedOn).format("LL")
                                }
                            },
                            {
                                "data": "Actions", "orderable": false, "width": "10%", "render": function (data, type, row) {
                                    return `<div class="d-flex"><button type = "button" style="margin-right: 10px;" class="btn btn-sm btn-secondary btn-icon" id="editService" data-id="${row.ID}"><i class="flaticon-edit"></i></button>
                                            <button type="button" class="btn btn-sm btn-danger btn-icon"><i class="flaticon-delete"></i></button></div>`;
                                }
                            }
                        ],
                        "initComplete": function () {
                            $('[data-toggle="tooltip"]').tooltip();

                        }
                    }).on('draw', function () {
                        $('[data-toggle="tooltip"]').tooltip();
                         });

                 $("#servicesModal").modal("show");
            })




          var table =   $('#providerTable').DataTable({
                "bPaginate": true,
                "bInfo": false,
                "processing": true, // for show progress bar
                //"serverSide": true, // for process server side
                "filter": true, // this is for disable filter (search box)
                "orderMulti": false, // for disable multiple column at once
                "language": {
                    "loadingRecords": "&nbsp;",
                    "sProcessing": "<i class='fas fa-spinner fa-2x text-success fa-spin'></i>",
                    "emptyTable": "No data available in table",
                    "info": "sInfo",
                    "infoFiltered": "sInfoFiltered",
                    "infoPostFix": "",
                    "thousands": ",",
                    "lengthMenu": "Show _MENU_ entries",
                    "loadingRecords": "Loading",
                    "processing": "Processing",
                    "search": "Search:",
                    "zeroRecords": "No records",
                    "aria": {
                        "sortAscending": ": Asc",
                        "sortDescending": ": Desc"
                    }
                },
                "bDestroy": true,
                "ajax": {
                    "url": "@Url.Action("GetProviders", "Provider")",
                    "type": "Get",
                },
                "columns": [
                    { "data": "Name", "name": "Name", "autoWidth": true },
                    { "data": "TelephoneNo", "name": "Contact", "autoWidth": true },
                    { "data": "Email", "name": "Email", "autoWidth": true },
                    { "data": "Address", "name": "Location", "autoWidth": true },
                    {
                        "data": "UpdatedOn", "name": "Last Modified", "type": "Date", "autoWidth": true, render: function (data, type, row) {
                            return moment(row.UpdatedOn).format("LL")
                        }
                    },
                    {
                        "data": "Actions", "orderable": false, "autoWidth": true, "render": function (data, type, row) {
                            return `<button type="button" class="btn btn-sm btn-primary" id="showServices" data-id="${row.ID}">Services</button>
                                <button type = "button" class="btn btn-sm btn-secondary btn-icon" id="editService" data-id="${row.ID}"><i class="flaticon-edit"></i></button>
                                    <button type="button" class="btn btn-sm btn-danger btn-icon"><i class="flaticon-delete"></i></button>`;
                        }
                    }
                ],
                "initComplete": function () {
                    $('[data-toggle="tooltip"]').tooltip();

                }
            }).on('draw', function () {
                $('[data-toggle="tooltip"]').tooltip();
                 });

           new $.fn.dataTable.Buttons(table, {
              buttons: [
                'excel'
                ]
             });

        var buttonContainer = table.buttons().container();
        var excelButton = buttonContainer.find(".buttons-excel");
        excelButton.addClass("btn-success").prepend(`<i class="fas fa-file-excel"></i>`);
        excelButton.find("span").text("Export XLS")
        buttonContainer.appendTo($('#exportButtonHolder'));

        })

</script>
}
