@{
    ViewBag.Title = "policies";
}
<style>
    #policiesTable_filter {
        float: right !important;
    }

    #subPoliciesTable_filter {
        float: right !important;
    }

    #policiesTable_filter input {
        width: 201px !important;
    }
</style>
<div class="kt-portlet kt-portlet--mobile pea-page" style="box-shadow: 5px 5px 15px 5px rgba(0,0,0,0.35);" id="customerPolicies">
    <div class="kt-portlet__head" style="background: #F35869 !important;min-height:32px;border-radius:4px;">
        <div class="kt-portlet__head-label">
            <span class="kt-portlet__head-icon">
                <i class="fas fa-user text-white"></i>
            </span>
            <h3 class="kt-portlet__head-title text-white" style="font-size:17px !important;">
                Customers Policies
            </h3>
        </div>
    </div>
    <div class="kt-portlet__body">
        <div class="row">
            <div class="col-md-12">
                <a class="btn text-white mb-2" id="btnBackToCustomersList" style="background-color:#1dc9b7 ;float:right !important;"><i class="fas fa-arrow-left"></i>Back to Customer List</a>
                <div class="kt-margin-r-10 kt-margin-l-10" style="float: right !important;" id="exportButtonHolder">
                </div>
            </div>
        </div>
        <div id="kt_table_1_wrapper" class="dataTables_wrapper dt-bootstrap4">
            <div class="row">
                <div class="col-sm-12" id="policiesListDiv">
                    <table class="table table-striped table-bordered table-hover table-checkable" id="policiesTable">
                        <thead>
                            <tr style="background-color: #22b9ff;">
                                <th style="color:#fff" data-field="PolicyNo">Policy No</th>
                                <th style="color:#fff" data-field="Contractor">Contracter</th>
                                <th style="color:#fff" data-field="CustomerCompany">Customer Company</th>
                                <th style="color:#fff" data-field="StartDate">Start Date</th>
                                <th style="color:#fff" data-field="ExpiryDate">Expiry Date</th>
                                <th style="color:#fff" data-field="LastModified">Last Modified</th>
                                <th style="color:#fff;width: 220px !important" data-field="Actions" >Actions</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>


<!--region Sub policies Model pop up -->
<div id="subPoliciesModal" class="modal animated slideInRight in slideInLeft out" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-xl" style="max-width: 85%">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title font-weight-bold">
                    Sub Policies
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body" id="subPoliciesModalBody">
                <div id="kt_table_1_wrapper" class="dataTables_wrapper dt-bootstrap4">

                    <div class="kt-portlet kt-portlet--mobile pea-page mb-3 d-none" style="background-color:#ff6868bf" id="customerPolicies">
                        <div class="kt-portlet__body p-3">
                            <div class="row">
                                <div class="col-md-12">
                                    <span class="h6 text-white" style="font-weight:700;">For Main Policy : </span><label class="text-white">@ViewBag.PolicyNo</label>
                                </div>
                                <div class="col-md-12">
                                    <span class="h6 text-white" style="font-weight:700;">Contractor : </span><label class="text-white">@ViewBag.Contractor</label>
                                </div>
                                <div class="col-md-12">
                                    <span class="h6 text-white" style="font-weight:700;">Customer : </span><label class="text-white">@ViewBag.Customer</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-12" id="personsListDiv">
                            <table class="table table-striped table-bordered table-hover table-checkable" id="subPoliciesTable">
                                <thead>
                                    <tr style="background-color: #22b9ff;">
                                        <th style="color:#fff" data-field="SubPolicyNo.">Sub Policy No.</th>
                                        <th style="color:#fff" data-field="EmployeeType">Employee Type</th>
                                        <th style="color:#fff" data-field="EmployeeRelation">Employee Relation</th>
                                        <th style="color:#fff" data-field="LastModified">LastModified</th>
                                        <th style="color:#fff" data-field="Actions">Actions</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary btn-bold btn-upper btn-font-sm" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<!--endregion Sub policies Model pop up -->

<!--region Editpolicy Model pop up -->
<div id="editPolicyModal" class="modal animated slideInRight in slideInLeft out" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-xl" style="max-width: 85%">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title font-weight-bold">
                    Policy
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body" id="editPolicyModalBody">

            </div>
        </div>
    </div>
</div>
<!--endregion Edit policy Model pop up -->




@section scripts
    {
    @Scripts.Render("~/Scripts/Datatable/Datatable/datatables.min.js")
    <script>
        $(document).ready(function () {
         $("#customerPolicies").on("click", "#editPolicy", function () {
                $.ajax({
                    url: '@Url.Action("EditPolicy", "Customers")',
                    data: {
                        policyNo: $(this).data("policyno")
                    },
                    success: function (data) {
                        $("#editPolicyModalBody").html(data);
                        $("#editPolicyModal").modal("show");
                    }
                })
         })

            




               //for sub policies model pop up
    $("#customerPolicies").on("click", "#btnsubPoliciesTable", function () {
                 var subPoliciesTable = $('#subPoliciesTable').DataTable({
                        "bPaginate": true,
                        "bInfo": false,
                        "processing": true, // for show progress bar
                        "serverSide": true, // for process server side
                        "filter": true, // this is for disable filter (search box)
                        "orderMulti": false, // for disable multiple column at once
                        "language": {
                            "loadingRecords": "&nbsp;",
                            "sProcessing": "<i class='fas fa-spinner fa-2x text-success fa-spin'></i>",
                            "emptyTable": "No data available in table",
                            "info": "sInfo",
                            "infoFiltered": "sInfoFiltered",
                            "infoPostFix": "",
                            "thousands": ",",
                            "lengthMenu": "Show _MENU_ entries",
                            "loadingRecords": "Loading",
                            "processing": "Processing",
                            "search": "Search:",
                            "zeroRecords": "No records",
                            "aria": {
                                "sortAscending": ": Asc",
                                "sortDescending": ": Desc"
                            }
                        },
                        "bDestroy": true,
                        "ajax": {
                            "url": `@Url.Action("GetSubPoliciesByPolicyNo", "Customers")?policyNo=CP1912151312482102`,
                            "type": "Get",
                     },
                         success: function (data) {

                    },
                        "columns": [
                            { "data": "SubPolicyNo", "name": "SubPolicyNo", "width": "20%" },
                            { "data": "EmployeeType", "name": "EmployeeType", "width": "20%" },
                            { "data": "EmployeeRelation", "name": "EmployeeRelation", "width": "20%" },
                            {
                                "data": "LastModified", "name": "LastModified", "type": "Date", "width": "25%", render: function (data, type, row) {
                                    return moment(row.LastModified).format("LL")
                                }
                            },
                            {
                                "data": "Actions", "orderable": false, "width": "10%", "render": function (data, type, row) {
                                    return `<div class="d-flex"><button type = "button" style="margin-right: 10px;" class="btn btn-sm btn-secondary btn-icon" id="editService" data-id="${row.ID}"><i class="flaticon-edit"></i></button>
                                            <button type="button" class="btn btn-sm btn-danger btn-icon"><i class="flaticon-delete"></i></button></div>`;
                                }
                            }
                        ],
                        "initComplete": function () {
                            $('[data-toggle="tooltip"]').tooltip();

                        }
                    }).on('draw', function () {
                        $('[data-toggle="tooltip"]').tooltip();
                         });

                 $("#subPoliciesModal").modal("show");
            })

           $('#policiesTable').DataTable({
                    "processing": true, // for show progress bar
                    //"serverSide": true, // for process server side
                    "filter": true, // this is for disable filter (search box)
                    "orderMulti": false, // for disable multiple column at once
                    "language": {
                        "loadingRecords": "&nbsp;",
                        "sProcessing": "<i class='fas fa-spinner fa-2x text-success fa-spin'></i>",
                        "emptyTable": "No data available in table",
                        "info": "Showing _START_ to _END_ of _TOTAL_ entries",
                        "infoEmpty": "Showing 0 to 0 of 0 entries",
                        "infoFiltered": "(filtered from _MAX_ total entries)",
                        "infoPostFix": "",
                        "thousands": ",",
                        "lengthMenu": "Show _MENU_ entries",
                        "loadingRecords": "Loading...",
                        "processing": "Processing...",
                        "search": "Search:",
                        "zeroRecords": "No matching records found",
                        "paginate": {
                            "first": "First",
                            "last": "Last",
                            "next": "Next",
                            "previous": "Previous"
                        },
                        "aria": {
                            "sortAscending": ": activate to sort column ascending",
                            "sortDescending": ": activate to sort column descending"
                        }
                    },
                    "bDestroy": true,
                    "ajax": {
                        "url": "@Url.Action("GetPolicies", "Customers")",
                    },
                    "columns": [

                        { "data": "PolicyNo", "name": "PolicyNo", "autoWidth": true },
                        { "data": "Contractor", "name": "Contractor", "autoWidth": true },
                        { "data": "CustomerCompany", "name": "CustomerCompany", "autoWidth": true },
                        {
                            "data": "StartDate", "name": "StartDate", "type": "Date", "autoWidth": true, render: function (data, type, row) {
                                return moment(row.StartDate).format("LL")
                            }
                        },
                        {
                            "data": "ExpiryDate", "name": "ExpiryDate", "type": "Date", "autoWidth": true, render: function (data, type, row) {
                                return moment(row.ExpiryDate).format("LL")
                            }
                        },
                        {
                            "data": "LastModified", "name": "LastModified", "type": "Date", "autoWidth": true, render: function (data, type, row) {
                                return moment(row.LastModified).format("LL")
                            }
                        },
                          {
                        "data": "Actions", "orderable": false, "autoWidth": true, "render": function (data, type, row) {
                            return `<button type="button" id="btnsubPoliciesTable" data-policyNo="${row.PolicyNo}" class="btn btn-sm btn-primary">View Policies</button>
                                <button type = "button" id="editPolicy" data-policyNo="${row.PolicyNo}" class="btn btn-sm btn-secondary btn-icon"><i class="flaticon-edit"></i></button>
                                    <button type="button" class="btn btn-sm btn-danger btn-icon"><i class="flaticon-delete"></i></button>`;
                        }
                    }
                    ],
                    "initComplete": function () {
                        $('[data-toggle="tooltip"]').tooltip();

                    }
                }).on('draw', function () {
                    $('[data-toggle="tooltip"]').tooltip();
                });
      });
    </script>

}

