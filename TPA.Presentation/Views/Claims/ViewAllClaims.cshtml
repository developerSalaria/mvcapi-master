@using Newtonsoft.Json;
@using TPA.Common.Core.Model;
@model TPAClaim

@{
    ViewBag.Title = "ViewAllClaims";
}
<style>

    #tblClaims_filter {
        float: right !important;
    }
    table th{
        color: white !important;
    }
</style>

<div class="kt-portlet kt-portlet--mobile pea-page" style="box-shadow: 5px 5px 15px 5px rgba(0,0,0,0.35);">
    <div class="kt-portlet__head" style="background: #F35869 !important;min-height:42px;border-radius:4px;">
        <div class="kt-portlet__head-label" >
            <span class="kt-portlet__head-icon">
                <i class="fas fa-filter text-white"></i>
            </span>
            <h3 class="kt-portlet__head-title text-white">
                Filter by
            </h3>
        </div>
    </div>

    <div class="kt-portlet__body">
        <div class="row">
            <div class="col-lg-12">
                <div class="row kt-margin-b-20">
                    <div class="col-lg-4 kt-margin-b-10">
                        <label class="font-weight-bold">Select Provider :</label>
                        <input type="text" class="form-control kt-input" id="txtProvider">
                    </div>

                    <div class="col-lg-4">
                        <label class="font-weight-bold">Select Contractor :</label>
                        <input type="text" class="form-control kt-input" id="txtContactractor">
                    </div>

                    <div class="col-lg-4 kt-margin-b-10">
                        <label class="font-weight-bold">Company Name :</label>
                        <input type="text" class="form-control kt-input" id="txtCompanyName" />
                    </div>

                    <div class="col-lg-4">
                        <label class="font-weight-bold">Employee Name :</label>
                        <input type="text" class="form-control kt-input" id="txtEmployeeName">
                    </div>

                    <div class="col-lg-4 kt-margin-b-10">
                        <label class="font-weight-bold">From Date :</label>
                        <div class="input-group date" id="ToDateDateHolder">
                            <input type="text" class="form-control kt-input" id="txtFromDate" />
                            <div class="input-group-append">
                                <span class="input-group-text"><i class="flaticon-calendar"></i></span>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 kt-margin-b-10">
                        <label class="font-weight-bold">To Date :</label>
                        <div class="input-group date" id="ToDateDateHolder">
                            <input type="text" class="form-control kt-input" id="txtToDate" />
                            <div class="input-group-append">
                                <span class="input-group-text"><i class="flaticon-calendar"></i></span>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 kt-margin-b-10">
                        <label class="font-weight-bold">Employee Insurance Id :</label>
                        <input type="text" class="form-control kt-input" id="txtEmployeeInsuranceId">
                    </div>

                    <div class="col-lg-3 kt-margin-b-10">
                        <label class="font-weight-bold">Status :</label>
                        @Html.DropDownListFor(m => m.StatusID, Dropdowns.GetStatus(), new { @class = "form-control kt-input dropDownSelect2", id = "ddlStatusId" })
                    </div>

                    <div class="col-lg-3 kt-margin-b-10">
                        <label class="font-weight-bold">Visit Type :</label>
                        @Html.DropDownListFor(m => m.VisitTypeID, Dropdowns.GetVisitTypes(), new { @class = "form-control kt-input dropDownSelect2", id = "ddlVisitTypeId" })
                    </div>

                    <div class="col-lg-3 kt-margin-b-10">
                        <label class="font-weight-bold">Claim Id :</label>
                        <input type="text" class="form-control kt-input" id="txtClaimId">
                    </div>

                    <div class="col-m-3 kt-margin-r-20  kt-margin-t-20">
                        <button class="btn btn-primary" onclick="searchClaimsReportsByFilters();"><i class="fas fa-search"></i>Search</button>
                    </div>
                    <div class="col-m-3 kt-margin-t-20">
                        <button class="btn btn-danger" onclick="clearClaimsFilters();"><i class="fas fa-eraser"></i>Clear</button>
                    </div>
                </div>
            </div>
        </div>

        <!--begin: Datatable -->
        <div id="kt_table_1_wrapper" class="dataTables_wrapper dt-bootstrap4">
            <div class="row">
                <div class="col-sm-12" id="reportDiv">
                    <table class="table table-striped- table-bordered table-hover table-checkable" id="tblClaims" style="width:100% !important;overflow-x: auto !important">
                        <thead>
                            <tr style="background-color: #00000061 !important;">
                                <th data-field="ClaimID">Claim ID</th>
                                <th data-field="ClaimNo">Claim No</th>
                                <th data-field="Provider">Provider</th>
                                <th data-field="InsuranceNo">Insurance No</th>
                                <th data-field="VisitType">Visit Type</th>
                                <th data-field="VisitDate">Visit Date</th>
                                <th data-field="VisiterName">Visitor Name</th>
                                <th data-field="Status">Status</th>
                                <th data-field="LastModified">Last Modified / Modified By</th>
                                <th data-field="CreatedBy">Created at / Created By</th>
                                <th data-field="Actions" style="width: 90px !important;">Actions</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
        <!--end: Datatable -->

    </div>
</div>

<div id="viewClaimsModal" class="modal animated slideInRight in slideInLeft out" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-xl" style="max-width: 85%">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title font-weight-bold">
                    Claim Details
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body" id="viewClaimsModalBody">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-clean btn-bold btn-upper btn-font-sm" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

@section scripts
    {
    @*<script src="~/Scripts/Common/Common.js" type="text/javascript"></script>*@
    @Scripts.Render("~/Scripts/Datatable/Datatable/datatables.min.js")
    <script type="text/javascript">
    $(document).ready(function () {
        $("#txtToDate").datepicker();
        $("#txtFromDate").datepicker();
    });

    // use for clear reports filers
    function clearClaimsFilters() {
        $("#txtProvider").val('');
        $("#txtContactractor").val('');
        $("#txtCompanyName").val('');
        $("#txtEmployeeName").val('');
        $("#txtFromDate").val('');
        $("#txtToDate").val('');
        $("#txtEmployeeInsuranceId").val('');
        $("#ddlStatusId").val('');
        $("#ddlVisitTypeId").val('');
        $("#txtClaimId").val('');
    };


 $('#tblClaims').DataTable({
                    "processing": true, // for show progress bar
                   // "serverSide": true, // for process server side
                    "filter": true, // this is for disable filter (search box)
                    "orderMulti": false, // for disable multiple column at once
                    "language": {
                        "loadingRecords": "&nbsp;",
                        "sProcessing": "<i class='fas fa-spinner fa-2x text-success fa-spin'></i>",
                        "emptyTable": "No data available in table",
                        "info": "Showing _START_ to _END_ of _TOTAL_ entries",
                        "infoEmpty": "Showing 0 to 0 of 0 entries",
                        "infoFiltered": "(filtered from _MAX_ total entries)",
                        "infoPostFix": "",
                        "thousands": ",",
                        "lengthMenu": "Show _MENU_ entries",
                        "loadingRecords": "Loading...",
                        "processing": "Processing...",
                        "search": "Search:",
                        "zeroRecords": "No matching records found",
                        "paginate": {
                            "first": "First",
                            "last": "Last",
                            "next": "Next",
                            "previous": "Previous"
                        },
                        "aria": {
                            "sortAscending": ": activate to sort column ascending",
                            "sortDescending": ": activate to sort column descending"
                        }
                    },
                    "bDestroy": true,
                    "ajax": {
                        "url": "@Url.Action("GetAllClaimsList", "Claims")",
                        "type": "Post",
                          "data": function (d) {
                            searchProvider = $("#txtProvider").val(),
                            searchContactractor = $("#txtContactractor").val(),
                            searchCompanyName = $("#txtCompanyName").val(),
                            searchEmployeeName = $("#txtEmployeeName").val(),
                            searchFromDate = $("#txtFromDate").val(),
                            searchToDate=$("#txtToDate").val(),
                            searchEmployeeInsuranceId=$("#txtEmployeeInsuranceId").val(),
                            searchStatusId=$("#ddlStatusId").val(),
                            searchVisitTypeId=$("#ddlVisitTypeId").val(),
                            searchClaimId=$("#txtClaimId").val()
                        }
     },
            //         "drawCallback": function () {
            //    responsiveDt.respond();
            //    $("a.view").tooltip({
            //        placement: 'top',
            //        trigger: 'hover',
            //        title: 'View Claim'
            //    });
            //    $("a.getPdf").removeAttr("title");
            //    $("a.getPdf").tooltip({
            //        placement: 'top',
            //        trigger: 'hover',
            //        title: 'Get PDF'
            //    });
            //    $("a.delete").removeAttr("title");
            //},
                    "columns": [
                        { "data": "ClaimID", "name": "ClaimID", "autoWidth": true },
                        { "data": "ClaimNo", "name": "ClaimNo", "autoWidth": true },
                        { "data": "Provider", "name": "Provider", "autoWidth": true },
                        { "data": "InsuranceNo", "name": "InsuranceNo", "autoWidth": true },
                        { "data": "VisitType", "name": "VisitType", "autoWidth": true },
                        { "data": "VisitDateStr", "name": "VisitDateStr", "autoWidth": true },
                        { "data": "VisiterName", "name": "VisiterName", "autoWidth": true },
                        { "data": "Status", "name": "Status", "autoWidth": true },
                        { "data": "LastModified", "name": "LastModified", "autoWidth": true },
                        { "data": "LastModified", "name": "LastModified", "autoWidth": true },
                        //{
                        //            "data": "Actions", "orderable": false, "autoWidth": true, "render": function (data, type, row) {
                        //        return `<button type="button" class="btn btn-sm btn-secondary btn-icon" onclick="loadClaimDetailsByClaimNo(\'' + row.ClaimID + '\')"><i class="fas fa-eye"></i></button>
                        //            <button type="button" class="btn btn-sm btn-danger btn-icon" onclick="loadClaimDetailsByClaimNo(\'' + row.ClaimID + '\')"><i class="fas fa-file-pdf"></i></button>`;
                        //      }
                        //}
                        {
                                    "data": "Actions", "orderable": false, "autoWidth": true, "render": function (data, type, row) {
                                return  '<button type="button" class="btn btn-sm btn-danger btn-icon" onclick="loadClaimDetailsByClaimNo(\'' + row.ClaimID + '\')"><i class="fas fa-eye"></i></button>';
                                   
                              }
                        }
                    ],
                    "initComplete": function () {
                        $('[data-toggle="tooltip"]').tooltip();

                    }
                }).on('draw', function () {
                    $('[data-toggle="tooltip"]').tooltip();
                });

        function loadClaimDetailsByClaimNo(claimId){
                $.ajax({
                    url: "@Url.Action("ViewClaim", "Claims")",
                    data: {
                        claimId: claimId,
                    },
                    success: function (html) {
                        $("#viewClaimsModalBody").html(html);
                        $("#viewClaimsModal").modal("show");
                    }
                })
            };
    </script>

}




