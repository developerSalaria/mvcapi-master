@using Newtonsoft.Json;
@using TPA.Common.Core.Model;
@model TPAClaim
@{
    ViewBag.Title = "Payment Report";
}
<style>

    #tblLossRatioReport_filter {
        float: right !important;
    }

    table th {
        color: white !important;
    }
</style>
<div class="kt-portlet kt-portlet--mobile pea-page" style="box-shadow: 5px 5px 15px 5px rgba(0,0,0,0.35);">
    <div class="kt-portlet__head" style="background: #F35869 !important;min-height:42px;border-radius:4px;">
        <div class="kt-portlet__head-label">
            <span class="kt-portlet__head-icon">
                <i class="fas fa-chart-bar text-white"></i>
            </span>
            <h3 class="kt-portlet__head-title text-white">
                Get Report By Loss Ratio
            </h3>
        </div>
    </div>
    <div class="kt-portlet__body">
        <div class="row">
            <div class="col-lg-12">
                <div class="row kt-margin-b-20">
                    <div class="col-lg-4 kt-margin-b-10">
                        <label class="font-weight-bold">Select Policy :</label>
                        <input type="text" class="form-control kt-input" id="txtPolicy">
                    </div>

                    <div class="col-lg-4">
                        <label class="font-weight-bold">Company Name :</label>
                        <input type="text" class="form-control kt-input" id="txtCompanyName">
                    </div>

                </div>
                <div class="row">
                    <div class="col-m-3 kt-margin-r-20 kt-margin-l-10">
                        <button class="btn btn-success" id="exportxls"><i class="fas fa-file-excel"></i>export XLS</button>
                    </div>
                    <div class="col-m-3 kt-margin-r-20">
                        <button class="btn btn-primary" onclick="searchLossRatioReportsByFilters();"><i class="fas fa-search"></i>Search</button>
                    </div>
                    <div class="col-m-3">
                        <button class="btn btn-danger" onclick="clearReportsFilters();"><i class="fas fa-eraser"></i>Clear</button>
                    </div>
                </div>
            </div>
        </div>

        <!--begin: Datatable -->
        <div id="kt_table_1_wrapper" class="dataTables_wrapper dt-bootstrap4">
            <div class="row">
                <div class="col-sm-12" id="reportDiv" style="display:none;">
                    <table class="table table-striped- table-bordered table-hover table-checkable" id="tblLossRatioReport" style="width:100%;">
                        <colgroup>
                            <col width="150" style="vertical-align:middle;" />
                            <col style="width:200px;" />
                        </colgroup>
                        <thead>
                            <tr class="text-white">
                                <th data-field="MainPolicyId">Main Policy Id</th>
                                <th data-field="MainPolicyNumber">Main Policy Number</th>
                                <th data-field="PolicyAmount">Policy Amount</th>
                                <th data-field="TotalInsured">Total Insured</th>
                                <th data-field="Ratio">Ratio</th>
                                <th data-field="Company">Company</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
        <!--end: Datatable -->
    </div>
</div>


@section scripts
    {
    @*<script src="~/Scripts/Common/Common.js" type="text/javascript"></script>*@
    @Scripts.Render("~/Scripts/Datatable/Datatable/datatables.min.js")
    <script type="text/javascript">
        $("#exportxls").click(function () {
           tableToExcel('tblLossRatioReport', 'Loss Ratio Report');
        });


        var tableToExcel = (function () {
    var uri = 'data:application/vnd.ms-excel;base64,'
      , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
      , base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))) }
      , format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) }
            return function (table, name) {
        if (!table.nodeType) table = document.getElementById('tblLossRatioReport')
        var ctx = { worksheet: name || 'Worksheet', table: table.innerHTML  }
        window.location.href = uri + base64(format(template, ctx))
    }
})()



    function searchLossRatioReportsByFilters() {
                debugger;
        $('#reportDiv').show();
         $('#divexportxls').show();
        $('#tblLossRatioReport').DataTable({
                    "filter": true,
                    "processing": true, // for show progress bar
                    "serverSide": true, // for process server side
                    "filter": false, // this is for disable filter (search box)
                    "orderMulti": false, // for disable multiple column at once
                    "language": {
                        "loadingRecords": "&nbsp;",
                        "sProcessing": "<i class='fas fa-spinner fa-2x text-success fa-spin'></i>",
                        "emptyTable": "No data available in table",
                        "info": "Showing _START_ to _END_ of _TOTAL_ entries",
                        "infoEmpty": "Showing 0 to 0 of 0 entries",
                        "infoFiltered": "(filtered from _MAX_ total entries)",
                        "infoPostFix": "",
                        "thousands": ",",
                        "lengthMenu": "Show _MENU_ entries",
                        "loadingRecords": "Loading...",
                        "processing": "Processing...",
                        "search": "Search:",
                        "zeroRecords": "No matching records found",
                        "paginate": {
                            "first": "First",
                            "last": "Last",
                            "next": "Next",
                            "previous": "Previous"
                        },
                        "aria": {
                            "sortAscending": ": activate to sort column ascending",
                            "sortDescending": ": activate to sort column descending"
                        }
                    },
                    "bDestroy": true,
                    "ajax": {
                        "url": "@Url.Action("SearchLossRatioReport", "Reports")",
                        "type": "Post",
                        //"datatype": "json",
                        "data": function (d) {
                            searchPolicy = $("#txtPolicy").val(),
                            searchCompanyName = $("#txtCompanyName").val()
                        }
                    },
                    "columns": [
                        { "data": "MainPolicyId", "name": "MainPolicyId", "autoWidth": true },
                        { "data": "MainPolicyNumber", "name": "MainPolicyNumber",  "autoWidth": true },
                        { "data": "PolicyAmount", "name": "PolicyAmount", "autoWidth": true },
                        { "data": "TotalInsured", "name": "TotalInsured", "autoWidth": true },
                        { "data": "Ratio", "name": "Ratio", "autoWidth": true },
                        { "data": "Company", "name": "Company", "autoWidth": true },
                    ],
                    "initComplete": function () {
                        $('[data-toggle="tooltip"]').tooltip();

                    }
                }).on('draw', function () {
                    $('[data-toggle="tooltip"]').tooltip();
                });
            }


    // use for clear reports filers
    function clearReportsFilters() {
        $("#txtPolicy").val('');
        $("#txtCompanyName").val('');
        $('#divexportxls').hide();
    };
    </script>

}



