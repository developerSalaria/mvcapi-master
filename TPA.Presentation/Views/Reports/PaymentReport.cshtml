@using Newtonsoft.Json;
@using TPA.Common.Core.Model;
@model TPAClaim
@{
    ViewBag.Title = "Payment Report";
}
    <div class="kt-portlet kt-portlet--mobile pea-page" style="box-shadow: 5px 5px 15px 5px rgba(0,0,0,0.35);">
        <div class="kt-portlet__head" style="background: #F35869 !important;min-height:42px;border-radius:4px;">
            <div class="kt-portlet__head-label">
                <span class="kt-portlet__head-icon">
                    <i class="fas fa-chart-bar text-white"></i>
                </span>
                <h3 class="kt-portlet__head-title text-white">
                    Get Report
                </h3>
            </div>
        </div>
        <div class="kt-portlet__body">
            <form method="post" action="/Reports/PaymentExcel">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="row kt-margin-b-20">
                            <div class="col-lg-4 kt-margin-b-10">
                                <label class="font-weight-bold">Select Provider :</label>
                                <input type="text" class="form-control kt-input" id="txtProvider">
                            </div>

                            <div class="col-lg-4">
                                <label class="font-weight-bold">Select Contractor :</label>
                                <input type="text" class="form-control kt-input" id="txtContactractor">
                            </div>

                            <div class="col-lg-4 kt-margin-b-10">
                                <label class="font-weight-bold">Company Name :</label>
                                <input type="text" class="form-control kt-input" id="txtCompanyName" />
                            </div>

                            <div class="col-lg-4">
                                <label class="font-weight-bold">Employee Name :</label>
                                <input type="text" class="form-control kt-input" id="txtEmployeeName">
                            </div>

                            <div class="col-lg-4 kt-margin-b-10">
                                <label class="font-weight-bold">From Date :</label>
                                <div class="input-group date" id="ToDateDateHolder">
                                    <input type="text" class="form-control kt-input" id="txtFromDate" />
                                    <div class="input-group-append">
                                        <span class="input-group-text"><i class="flaticon-calendar"></i></span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-4 kt-margin-b-10">
                                <label class="font-weight-bold">To Date :</label>
                                <div class="input-group date" id="ToDateDateHolder">
                                    <input type="text" class="form-control kt-input" id="txtToDate" />
                                    <div class="input-group-append">
                                        <span class="input-group-text"><i class="flaticon-calendar"></i></span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-3 kt-margin-b-10">
                                <label class="font-weight-bold">Employee Insurance Id :</label>
                                <input type="text" class="form-control kt-input" id="txtEmployeeInsuranceId">
                            </div>

                            <div class="col-lg-3 kt-margin-b-10">
                                <label class="font-weight-bold">Status :</label>
                                @Html.DropDownListFor(m => m.StatusID, Dropdowns.GetStatus(), new { @class = "form-control kt-input dropDownSelect2", id = "ddlStatusId" })
                            </div>

                            <div class="col-lg-3 kt-margin-b-10">
                                <label class="font-weight-bold">Visit Type :</label>
                                @Html.DropDownListFor(m => m.VisitTypeID, Dropdowns.GetVisitTypes(), new { @class = "form-control kt-input dropDownSelect2", id = "ddlVisitTypeId" })
                            </div>

                            <div class="col-lg-3 kt-margin-b-10">
                                <label class="font-weight-bold">Claim Id :</label>
                                <input type="text" class="form-control kt-input" id="txtClaimId">
                            </div>

                            <div class="col-lg-3 kt-margin-b-10">
                                <label class="font-weight-bold">Payment Status</label>
                                @Html.DropDownListFor(m => m.StatusID, Dropdowns.GetStatus(), new { @class = "form-control kt-input dropDownSelect2", id = "ddlPaymentStatusId" })
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-m-3 kt-margin-r-20 kt-margin-l-10">
                                <button class="btn btn-success" type="submit" id="exportxls"><i class="fas fa-file-excel"></i>export XLS</button>
                            </div>
                            <div class="col-m-3 kt-margin-r-20">
                                <button class="btn btn-primary"  type="button" onclick="searchServiceProviderReportsByFilters();"><i class="fas fa-search"></i>Search</button>
                            </div>
                            <div class="col-m-3">
                                <button class="btn btn-danger"  type="button" onclick="clearReportsFilters();"><i class="fas fa-eraser"></i>Clear</button>
                            </div>
                        </div>
                    </div>
                </div>
                </form>

                <!--begin: Datatable -->

                <div id="kt_table_1_wrapper" class="dataTables_wrapper dt-bootstrap4" style="overflow-y:hidden">
                    <div class="row">
                        <div class="col-sm-12" id="reportDiv" style="display:none;">
                            <table class="table table-striped- table-bordered table-hover table-checkable" id="myDatatable" style="width:100%;">
                                <colgroup>
                                    <col width="150" style="vertical-align:middle;" />
                                    <col style="width:200px;" />
                                </colgroup>
                                <thead>
                                    <tr>
                                        <th data-field="ClaimNumber">Claim Number</th>
                                        <th data-field="InsuredName">Insured Name</th>
                                        <th data-field="Provider">Provider</th>
                                        <th data-field="Visittype">Visit Type</th>
                                        <th data-field="VisitDate">Visit Date</th>
                                        <th data-field="PaymentInfo">Payment Info</th>
                                        <th data-field="Status">Status</th>
                                        <th data-field="LastModified">Last Modified</th>
                                        <th data-field="ProviderNotes">Provider Notes</th>
                                        <th data-field="AuditorNotes">Auditor Notes</th>
                                        <th data-field="ServiceName">Service Name</th>
                                        <th data-field="ServiceType">Services Type</th>
                                        <th data-field="Servicesubtype">Services Sub Type</th>
                                        <th data-field="Coshareamount">Coshare amount</th>
                                        <th data-field="Insured">Insured</th>
                                        <th data-field="CoShareType">Co Share Type</th>
                                        <th data-field="CoShare">Co Share</th>
                                        <th data-field="ServiceStatus">Service Status</th>
                                        <th data-field="Symptoms">Symptoms</th>
                                        <th data-field="InsuranceCompany">Insurance Company</th>
                                        <th data-field="PolicyNumber">Policy Number</th>
                                        <th data-field="SubPolicy">Sub Policy</th>
                                        <th data-field="PaymentStatus">Payment Status</th>

                                        <th data-field="PaymentDate">Payment Date</th>
                                        <th data-field="PaymentDetails">Payment Details</th>
                                        <th data-field="PaymentLastmodifiedby">Payment Last modified by</th>
                                        <th data-field="PaymentLastmodifiedDate">Payment Last modified Date</th>
                                        <th data-field="PaymentReference">Payment Reference</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
                <!--end: Datatable -->
        </div>
    </div>


@section scripts
    {
    @*<script src="~/Scripts/Common/Common.js" type="text/javascript"></script>*@
    @Scripts.Render("~/Scripts/Datatable/Datatable/datatables.min.js")
    <script type="text/javascript">
    $(document).ready(function () {
        $("#txtToDate").datepicker();
        $("#txtFromDate").datepicker();
    });

        $("#exportxls").click(function () {
           tableToExcel('myDatatable', 'Provider Report');
        });



        var tableToExcel = (function () {
    var uri = 'data:application/vnd.ms-excel;base64,'
      , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
      , base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))) }
      , format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) }
            return function (table, name) {
        if (!table.nodeType) table = document.getElementById('myDatatable')
        var ctx = { worksheet: name || 'Worksheet', table: table.innerHTML  }
        window.location.href = uri + base64(format(template, ctx))
    }
})()

    

    function searchServiceProviderReportsByFilters() {
                debugger;
        $('#reportDiv').show();
         $('#divexportxls').show();

                $('#myDatatable').DataTable({
                    "processing": true, // for show progress bar
                    "serverSide": true, // for process server side
                    "filter": false, // this is for disable filter (search box)
                    "orderMulti": false, // for disable multiple column at once
                    "language": {
                        "loadingRecords": "&nbsp;",
                        "sProcessing": "<i class='fas fa-spinner fa-2x text-success fa-spin'></i>",
                        "emptyTable": "No data available in table",
                        "info": "Showing _START_ to _END_ of _TOTAL_ entries",
                        "infoEmpty": "Showing 0 to 0 of 0 entries",
                        "infoFiltered": "(filtered from _MAX_ total entries)",
                        "infoPostFix": "",
                        "thousands": ",",
                        "lengthMenu": "Show _MENU_ entries",
                        "loadingRecords": "Loading...",
                        "processing": "Processing...",
                        "search": "Search:",
                        "zeroRecords": "No matching records found",
                        "paginate": {
                            "first": "First",
                            "last": "Last",
                            "next": "Next",
                            "previous": "Previous"
                        },
                        "aria": {
                            "sortAscending": ": activate to sort column ascending",
                            "sortDescending": ": activate to sort column descending"
                        }
                    },
                    "bDestroy": true,
                    "ajax": {
                        "url": "@Url.Action("SearchPaymentReports", "Reports")",
                        "type": "Post",
                        //"datatype": "json",
                        "data": function (d) {
                            searchProvider = $("#txtProvider").val(),
                            searchContactractor = $("#txtContactractor").val(),
                            searchCompanyName = $("#txtCompanyName").val(),
                            searchEmployeeName = $("#txtEmployeeName").val(),
                            searchFromDate = $("#txtFromDate").val(),
                            searchToDate=$("#txtToDate").val(),
                            searchEmployeeInsuranceId=$("#txtEmployeeInsuranceId").val(),
                            searchStatusId=$("#ddlStatusId").val(),
                            searchVisitTypeId=$("#ddlVisitTypeId").val(),
                            searchClaimId=$("#txtClaimId").val()
                            searchPaymentStatusId=$("#ddlPaymentStatusId").val()
                        }
                    },
                    "columns": [

                        { "data": "ClaimNumber", "name": "ClaimNumber", "autoWidth": true },
                        { "data": "InsuredName", "name": "InsuredName",  "autoWidth": true },
                        { "data": "Provider", "name": "Provider", "autoWidth": true },
                        { "data": "Visittype", "name": "Visittype", "autoWidth": true },
                        { "data": "VisitDate", "name": "VisitDate", "autoWidth": true },
                        { "data": "PaymentInfo", "name": "PaymentInfo", "autoWidth": true },
                        { "data": "Status", "name": "Status", "autoWidth": true },
                        { "data": "LastModified", "name": "LastModified", "autoWidth": true },
                        { "data": "ProviderNotes", "name": "ProviderNotes", "autoWidth": true },
                        { "data": "AuditorNotes", "name": "AuditorNotes", "autoWidth": true },
                        { "data": "ServiceName", "name": "ServiceName", "autoWidth": true },
                        { "data": "ServiceType", "name": "ServiceType", "autoWidth": true },
                        { "data": "Servicesubtype", "name": "Servicesubtype", "autoWidth": true },
                        { "data": "Coshareamount", "name": "Coshareamount", "autoWidth": true },
                        { "data": "Insured", "name": "Insured", "autoWidth": true },
                        { "data": "CoShareType", "name": "CoShareType", "autoWidth": true },
                        { "data": "CoShare", "name": "CoShare", "autoWidth": true },
                        { "data": "ServiceStatus", "name": "ServiceStatus", "autoWidth": true },
                        { "data": "Symptoms", "name": "Symptoms", "autoWidth": true },
                        { "data": "InsuranceCompany", "name": "InsuranceCompany", "autoWidth": true },
                        { "data": "PolicyNumber", "name": "PolicyNumber", "autoWidth": true },
                        { "data": "SubPolicy", "name": "SubPolicy", "autoWidth": true },
                        { "data": "PaymentStatus", "name": "PaymentStatus", "autoWidth": true },
                        { "data": "PaymentDate", "name": "PaymentDate", format: 'DD/MM/YYYY', "autoWidth": true },
                        { "data": "PaymentDetails", "name": "PaymentDetails", "autoWidth": true },
                        { "data": "PaymentLastmodifiedby", "name": "PaymentLastmodifiedby", "autoWidth": true },
                        { "data": "PaymentLastmodifiedDate", "name": "PaymentLastmodifiedDate", format: 'DD/MM/YYYY', "autoWidth": true },
                        { "data": "PaymentReference", "name": "PaymentReference", "autoWidth": true }
                    ],
                    "initComplete": function () {
                        $('[data-toggle="tooltip"]').tooltip();

                    }
                }).on('draw', function () {
                    $('[data-toggle="tooltip"]').tooltip();
                });
            }


    // use for clear reports filers
    function clearReportsFilters() {
        $("#txtProvider").val('');
        $("#txtContactractor").val('');
        $("#txtCompanyName").val('');
        $("#txtEmployeeName").val('');
        $("#txtFromDate").val('');
        $("#txtToDate").val('');
        $("#txtEmployeeInsuranceId").val('');
        $("#ddlStatusId").val('');
        $("#ddlVisitTypeId").val('');
        $("#txtClaimId").val('');
         $('#divexportxls').hide();
    };


    //
    </script>

}



